# Введение #

В рамках данного проекта предполагалось помогать русскоязычным разработчикам внедрять Openbravo POS на территории [бывшего СССР](http://ru.wikipedia.org/wiki/%D0%91%D1%8B%D0%B2%D1%88%D0%B8%D0%B9_%D0%A1%D0%A1%D0%A1%D0%A0), но так как на территории когда-то единой страны появилось и продолжают появляться новые государства, существует необходимость адаптировать систему согласно региональных условий. Разработчикам необходимо учитывать законодательство, валюту и правила документооборота каждой конкретной страны, именно этому и посвящается материал данной статьи.

Первоначально здесь будут представлены примеры основанные на опыте применения Openbravo POS в [Республике Казахстан](http://ru.wikipedia.org/wiki/%D0%9A%D0%B0%D0%B7%D0%B0%D1%85%D1%81%D1%82%D0%B0%D0%BD), в дальнейшем они могут быть дополнены материалами полученными при внедрении в других странах на территории [бывшего СССР](http://ru.wikipedia.org/wiki/%D0%91%D1%8B%D0%B2%D1%88%D0%B8%D0%B9_%D0%A1%D0%A1%D0%A1%D0%A0).

# Выбор языка интерфейса и страны внедрения #
В существующих сборках Openbravo POS в списке **Региональных настроек** присутствуют не все страны вышедшие из состава [СССР](http://ru.wikipedia.org/wiki/%D0%A1%D0%A1%D0%A1%D0%A0), что вызывает определённые трудности при внедрении системы в данных регионах. Установка языка влияет на то, какие файлы локализации будут загружены при запуске. Установка страны будет влиять какие региональные настройки будут использованы при значении _(Default)_ в них.

## Изменение файла настроек openbravopos.properties ##
Для использования региональных настроек не входящих в список необходимо внести изменения в файл настроек `openbravopos.properties` в рабочем каталоге Openbravo POS. Параметр `user.language` отвечает за язык интерфейса, а параметр `user.country` за региональные настройки по-умолчанию. Пример настроек для русского языка в Республике Казахстан:
```
user.language=ru
user.country=KZ
```

## Добавление языков для 15 республик бывшего СССР ##
Для того, чтобы каждый раз не вносить изменения в файл настроек, а выбирать их в **Система -> Оборудование** из списка **Региональные настройки**, необходимо внести изменения в исходный код. Добавить в метод `JPanelConfigLocale` класса `JPanelConfigLocale` строки:

```
        // языки стран образовавшихся после распада СССР

        addLocale(availablelocales, new Locale("am", "AM", "")); // армянский (Армения)
        addLocale(availablelocales, new Locale("az", "AZ", "")); // азербайджанский (Азербайджан)
        addLocale(availablelocales, new Locale("be", "BY", "")); // белорусский (Белоруссия)
        addLocale(availablelocales, new Locale("et", "EE", "")); // эстонский (Эстония)
        addLocale(availablelocales, new Locale("ka", "GE", "")); // грузинский (Грузия)
        addLocale(availablelocales, new Locale("kk", "KZ", "")); // казахский (Казахстан)
        addLocale(availablelocales, new Locale("ky", "KG", "")); // киргизский (Киргизия)
        addLocale(availablelocales, new Locale("lt", "LT", "")); // литовский (Литва)
        addLocale(availablelocales, new Locale("lv", "LV", "")); // латышский (Латвия)
        addLocale(availablelocales, new Locale("mo", "MD", "")); // молдавский (Молдавия)
        addLocale(availablelocales, new Locale("ru", "KZ", "")); // русский (Казахстан)
        addLocale(availablelocales, new Locale("ru", "RU", "")); // русский (Россия)
        addLocale(availablelocales, new Locale("tg", "TJ", "")); // таджикский (Таджикистан)
        addLocale(availablelocales, new Locale("tk", "TM", "")); // туркменский (Туркмения)
        addLocale(availablelocales, new Locale("uk", "UA", "")); // украинский (Украина)
        addLocale(availablelocales, new Locale("uz", "UZ", "")); // узбекский (Узбекистан)
```

Они добавят в список наименования языков согласно [ISO 639-1](http://en.wikipedia.org/wiki/List_of_ISO_639-1_codes) и названия стран согласно [ISO 3166-1](http://en.wikipedia.org/wiki/ISO_3166-1). Также могут быть созданы комбинации из языка и страны, например в [Республике Казахстан](http://ru.wikipedia.org/wiki/%D0%9A%D0%B0%D0%B7%D0%B0%D1%85%D1%81%D1%82%D0%B0%D0%BD)(код **KZ**) официально действуют два языка казахский(код **kk**) и русский(код **ru**), то есть в программе используются две записи _казахский (Казахстан)_ и _русский (Казахстан)_.

Представленные выше изменения в исходном коде основаны на [сообщении 7005659](http://forge.openbravo.com/plugins/espforum/view.php?group_id=101&forumid=434922&topicid=7005659) в форуме [forge.openbravo.com](http://forge.openbravo.com/) и были внесены в репозитарий данного проекта [r268](https://code.google.com/p/openbravoposru/source/detail?r=268).

|![![](http://farm3.static.flickr.com/2686/4130637278_7249d22e6e_m.jpg)](http://farm3.static.flickr.com/2686/4130637278_0a106eb80a_o.png)|
|:---------------------------------------------------------------------------------------------------------------------------------------|
|Выбор **kk\_KZ**                                                                                                                        |

# Валюта #
## Изображение ##
По-умолчанию в Openbravo POS встроены изображения [Евро(EUR)](http://ru.wikipedia.org/wiki/%D0%95%D0%B2%D1%80%D0%BE) для номиналов банкнот и монет. Они необходимы для отображения кнопок в окне **Платёж** при оплате покупки наличными (вкладка **Наличные**). Для установки своих номиналов валют необходимо:
  * добавить изображения в раздел **Ресурсы** программы;
  * внести наименование изображения и номинал в системный ресурс **payment.cash**.

### Пример добавления изображения валюты ###
  1. Загрузить и сохранить локально [изображение монеты](http://ru.wikipedia.org/wiki/%D0%A4%D0%B0%D0%B9%D0%BB:100_Tenge_(1).gif).
  1. Перейти в **Администрация -> Настройки -> Ресурсы**.
  1. Нажать кнопку для создания нового ресурса.
  1. Набрать наименование _coin.100tenge_ в поле **Название**.
  1. Выбрать тип системного ресурса _Изображение_.
  1. Указать путь к файлу с изображением.
  1. Сохранить ресурс.

  1. Загрузить и сохранить локально [изображение банкноты](http://ru.wikipedia.org/wiki/%D0%A4%D0%B0%D0%B9%D0%BB:1000_tenge_(2006)_r.jpg).
  1. Перейти в **Администрация -> Настройки -> Ресурсы**.
  1. Нажать кнопку для создания нового ресурса.
  1. Набрать наименование _banknote.1000tenge_ в поле **Название**.
  1. Выбрать тип системного ресурса _Изображение_.
  1. Указать путь к файлу с изображением.
  1. Сохранить ресурс.

### Пример изменения системного ресурса payment.cash ###
  1. Перейти в **Управление -> Настройки -> Ресурсы**.
  1. Выбрать текстовый ресурс `payment.cash`.
  1. В конец текста добавить строки:
```
payment.addButton("banknote.1000tenge", 1000.0);
payment.addButton("coin.100tenge", 100.0);
```
  1. Сохранить системный ресурс.
  1. Проверить работу в окне **Платёж**.

## Обозначение ##
Для большинства валют существуют знаки для их краткого обозначения. В Openbravo POS эти знаки выводятся в полях где задаются значения денежного типа. Изменения для вывода денежного формата производится в разделе **Региональные настройки** окна **Оборудование**.

### Пример вывода символа Тенге(KZT) ###
20 марта 2007 года [Национальным Банком Казахстана](http://www.nationalbank.kz/) был графический символ для обозначения национальной валюты [Тенге(KZT)](http://ru.wikipedia.org/wiki/%D0%9A%D0%B0%D0%B7%D0%B0%D1%85%D1%81%D1%82%D0%B0%D0%BD%D1%81%D0%BA%D0%B8%D0%B9_%D1%82%D0%B5%D0%BD%D0%B3%D0%B5). C 16 мая 2008 года данный символ был принят в Unicode под кодом ₸ (U+20B8), с 24 апреля 2009 включён в ISO. [Подробнее...](http://www.unicode.org/charts/PDF/U20A0.pdf)

  1. Перейти в **Система -> Оборудование**.
  1. В поле **Денежный формат** раздела **Региональные настройки** ввести:
```
#0 ₸
```
  1. Нажать кнопку **Сохранить** и перегрузить приложение.
  1. Проверить отображение символа `₸` при выводе значений в денежном формате.

|![![](http://farm3.static.flickr.com/2609/3884072120_fd48d191ba_m.jpg)](http://farm3.static.flickr.com/2609/3884072120_8eb3d4a2e6_o.png)|![![](http://farm3.static.flickr.com/2580/3883390413_4e4bc24e4d_m.jpg)](http://farm3.static.flickr.com/2580/3883390413_3217c527d1_o.png)|![![](http://farm3.static.flickr.com/2450/3884072216_4647676e0c_m.jpg)](http://farm3.static.flickr.com/2450/3884072216_d6922f0f77_o.png)|
|:---------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------|
|Добавление нового ресурса                                                                                                               |Настройка денежного формата                                                                                                             |Результат в окне **Платёж**                                                                                                             |

# Документооборот #
## Форма чека ##
В стране законодательно могут быть установлены обязательные поля отражённые в чеки, так для [Республики Казахстан](http://ru.wikipedia.org/wiki/%D0%9A%D0%B0%D0%B7%D0%B0%D1%85%D1%81%D1%82%D0%B0%D0%BD) устанавливается:
  * указывать в чеки наименования организации или индивидуального предпринимателя осуществляющего выдачу чека;
  * его регистрационный номер налогоплательщика(РНН);
  * в случае если он является плательщиком по налогу по добавленной стоимости(НДС), то требуется указать серию и номер выданного свидетельства о постановки на учёт по НДС.
Для того, чтобы эти данные печатались на чеке при выдаче его покупателю необходимо:
  1. Перейти в **Администрация -> Настройки -> Ресурсы**.
  1. В ресурсе **Printer.Start** добавить следующие строки:
```
        <line></line>
        <line>
            <text align="center" length="42">ИП Сидорчук С.С.</text>
        </line>
        <line>
            <text align="center" length="42">РНН 3917000000000</text>
        </line>
        <line>
            <text align="center" length="42">Св-во по НДС 00001 № 00001234</text>
        </line>
        <line></line>
```
  1. Сохранить ресурс.
  1. Проверить правильность вывода информации об организации или предпринимателе.

|![![](http://farm4.static.flickr.com/3515/3995408866_6f2995b986_m.jpg)](http://farm4.static.flickr.com/3515/3995408866_915eacf694_o.png)|![![](http://farm4.static.flickr.com/3447/3995408914_3e948425b2_m.jpg)](http://farm4.static.flickr.com/3447/3995408914_85c343fe8a_o.png)|
|:---------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------|
|Редактирование шаблона                                                                                                                  |Пример чека                                                                                                                             |

## Выписка счёта ##
От того в какой стране будет применяться система Openbravo POS зависит, какие документы будут формироваться на основе данных учёта. Форма этих документов зависит от установленных правил или сложившихся традиций документооборота в данной стране.

Наиболее востребованным документом формируемым на основе данных чека является счёт на оплату и счёт-фактура. В [Openbravo Wiki](http://wiki.openbravo.com/wiki/Main_Page) предложен [скрипт](http://wiki.openbravo.com/wiki/Openbravo_POS_Scripting_Tutorial#Create_a_report_to_print_an_invoice_at_the_end_of_a_sale) для формировании счёта на оплату на основании чека. Ниже предлагается вариант скрипта формирования счёт-фактуры установленной для [Республики Казахстан](http://ru.wikipedia.org/wiki/%D0%9A%D0%B0%D0%B7%D0%B0%D1%85%D1%81%D1%82%D0%B0%D0%BD). В нём используются шаблон отчёта созданный с помощью [iReport](http://jasperforge.org/projects/ireport) и печатаемый после проведения каждой продажи.

|![![](http://farm3.static.flickr.com/2747/4130637790_b1dd26d43e_m.jpg)](http://farm3.static.flickr.com/2747/4130637790_a82a980e20_o.png)|
|:---------------------------------------------------------------------------------------------------------------------------------------|
|Редактирование в **iReport**                                                                                                            |

### Пример формирования счёта-фактуры на трёх языках для Республики Казахстан (en\_KZ, kk\_KZ и ru\_KZ) ###

Первым необходимо создать скрипт для печати отчёта после каждой продажи. Для этого дополнить ресурс `Ticket.Buttons` строкой:

```
<event key="ticket.close" code="Script.PrintInvoiceTax"/> 
```

Данная строка события вызывает скрипт `Script.PrintInvoiceTax` при завершении каждой продажи.

Вторым шагом создать скрипт для печати отчёта. Для этого создать новый текстовый ресурс `Script.PrintInvoiceTax` содержащий строку:

```
sales.printReport("/com/openbravo/reports/invoicetax");
```

Данная строка запускает файл отчёта `invoicetax.jrxml`, который необходимо разместить в папке с отчётами. Для этого распакуйте [OpenbravoPOS-reports-invoicetax.zip](http://openbravoposru.googlecode.com/files/OpenbravoPOS-reports-invoicetax.zip) в папку `reports/com/openbravo/reports/`. Папка будет содержать следующие файлы:
  * `invoicetax.jrxml`
  * `invoicetax_lines.jrxml`
  * `invoicetax_messages_en_KZ.properties`
  * `invoicetax_messages_kk_KZ.properties`
  * `invoicetax_messages_ru_KZ.properties`
  * `invoicetax_lines_messages_en_KZ.properties`
  * `invoicetax_lines_messages_kk_KZ.properties`
  * `invoicetax_lines_messages_ru_KZ.properties`

Файл отчёт `invoicetax.jrxml` выводит основную часть счёта-фактуры содержащую реквизиты покупателя и поставщика. Файл `invoicetax_lines.jrxml` это дочерний отчёт, он выводит содержимое строк счёт-фактуры. Так же в папке содержаться файлы расширением `.properties` с ресурсами необходимые для заполнения текстовых полей шаблонов отчета на английском(**en\_KZ**), казахском(**kk\_KZ**) и русском(**ru\_KZ**) языках, для того чтобы файлы ресурсов использовались корректно необходимо правильно выставить региональные настройки. Предложенные файлы могут быть изменены в зависимости от условий бизнеса. Файлы отчётов могут быть изменены с помощью [графического редактора iReport](http://jasperforge.org/website/ireportwebsite/IR%20Website/ir_download.html?header=project&target=ireport) или специального [плагина для NetBeans IDE 3.x](http://sourceforge.net/projects/ireport/files/iReport%20Plugin%20for%20NetBeans/iReport-3.6.1/iReport-nb-3.6.1-plugin.zip/download). Из этих же программ могут быть изменены файлы ресурсов. При этом следует обратить внимание, что переменные в файлах ресурсов начинающиеся на `label` отвечают за подписи полей и ячеек на разных языках, а переменные начинающихся на `field` за их содержание. Переменные `field` предназначены для установки констант, таких как наименование организации, её адрес, РНН и т.п.

По завершению в Openbravo POS в панели **Оборудование** выберите **Принтер отчётов** для вывода на него счёт-фактур. Перезапустить Openbravo POS и проверить формирование счёта-фактуры при продаже в панели **Продажи**.

|![![](http://farm3.static.flickr.com/2599/4129872253_c06ed47b64_m.jpg)](http://farm3.static.flickr.com/2599/4129872253_f9d1f8174a_o.png)|![![](http://farm3.static.flickr.com/2640/4130638562_69c1510f95_m.jpg)](http://farm3.static.flickr.com/2640/4130638562_336d555bf6_o.png)|![![](http://farm3.static.flickr.com/2551/4129873167_01577fdc40_m.jpg)](http://farm3.static.flickr.com/2551/4129873167_3159bc5c50_o.png)|
|:---------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------|
|Счёт-фактура **en\_KZ**                                                                                                                 |Счёт-фактура **kk\_KZ**                                                                                                                 |Счёт-фактура **ru\_KZ**                                                                                                                 |

# Законодательство #
## Налогообложение ##
### Пример начисления налога на добавленную стоимость ###
В качестве примера рассмотрим применение ставки НДС в [Республике Казахстан](http://ru.wikipedia.org/wiki/%D0%9A%D0%B0%D0%B7%D0%B0%D1%85%D1%81%D1%82%D0%B0%D0%BD) на 2009 год. Для применения ставок налогообложения к реализуемым товарам и услугам при продаже существует специальный механизм управления налогами и налоговыми группами в Openbravo POS. Для его применения необходимо записать ставку налога и налоговую групп в которую входит этот налог:
  1. Перейти в **Администрация -> Управление -> Налоговые группы**.
  1. Создать новую налоговую группу _НДС_.
  1. Заполнить поле **Название**.
  1. Сохранить запись налоговой группы _НДС_.
  1. Перейти в **Администрация -> Управление -> Налоги**.
  1. Создать новую запись для группы _НДС_.
  1. Заполнить поле **Название**.
  1. Выбрать налоговую группу в поле **Налоговая группа**.
  1. В поле **Ставка** вести значение ставки _12%_.
  1. Сохранить запись налога _НДС 12%_.
Для его использования при реализации отдельных номенклатурных позиций необходимо:
  1. Перейти в **Администрация -> Управление -> Товары**.
  1. Для товарной позиции измените **Налоговая группа** выбрав из списка _НДС_.
  1. Задать цену товара:
    * если налог включён в цену, то указать конечную цену продажи в поле **Цена продажи + налог**;
    * если налог начислен на цену, то указать конечную цену продажи в поле **Цена продажи**.
  1. Сохранить номенклатурную позицию.
Для его использования при продаже товара без указания наименования товара:
  1. Перейти в **Администрация -> Настройки -> Ресурсы** и изменить ресурс `Ticket.Buttons`.
  1. Убрать `<!--` и `-->` для переменной `taxcategoryid`.
  1. Задать значение `TAXES.ID` налоговой группы для `value`. Значение `TAXES.ID` можно узнать только выполнив SQL-запрос `SELECT ID, NAME FROM TAXES`.
  1. Указать тип начисления налога в значении `taxesincluded`:
    * если налог включён в стоимость, то значение `value` равно `true`;
    * если налог начислен на стоимость, то значение `value` равно `false`.
  1. Теперь при продаже товара без указания наименования будет учитываться назначенная налоговая группа и начисляться налог согласно установленного правила.
|![![](http://farm3.static.flickr.com/2796/4132063533_86372d06bd_m.jpg)](http://farm3.static.flickr.com/2796/4132063533_0cab3fa951_o.png)|
|:---------------------------------------------------------------------------------------------------------------------------------------|
|Варианты начисления налогов                                                                                                             |